# Roadmap Разработки Frontend: "Hiking Club Management"

## Общая стратегия

Мы разделим разработку на четыре основных этапа. Каждый этап состоит из спринтов (условно по 2 недели), что позволяет итеративно создавать и тестировать функционал. Приоритет отдается сначала публичной части для привлечения пользователей, затем — административной для управления контентом.

---

### **Этап 1: Foundation & Setup (Спринт 0-1, ~1 неделя)**

**Цель:** Настроить окружение, архитектуру проекта и базовые UI-компоненты. Заложить прочный фундамент для дальнейшей разработки.

**Технические задачи:**

1.  **Инициализация проекта:**
    *   Проверить и донастроить существующий Next.js 14 проект.
    *   Установить все зависимости: `tailwindcss`, `shadcn/ui`, `@tanstack/react-query`, `react-hook-form`, `zod`, `mapbox-gl`, `react-map-gl`, `@tiptap/react`, `@tiptap/starter-kit`, `axios`.
    *   Выполнить команду `npx shadcn-ui@latest init` для настройки `globals.css`, `tailwind.config.ts` и `lib/utils.ts`.

2.  **Архитектура и структура папок:**
    *   Создать базовую структуру в `src/`:
        *   `app/`: Роутинг Next.js.
        *   `components/`: Глобальные переиспользуемые компоненты (например, `Header`, `Footer`, `Map`).
            *   `components/ui/`: Компоненты, сгенерированные `shadcn/ui`.
        *   `lib/`: Вспомогательные функции.
            *   `lib/api.ts`: Настроить экземпляр `axios` для взаимодействия с вашим backend API. Включить `baseURL`, `withCredentials: true` (для http-only cookies).
            *   `lib/utils.ts`: Утилиты от `shadcn/ui` и кастомные хелперы.
        *   `hooks/`: Кастомные хуки (например, `useAuth`).
        *   `providers/`: Провайдеры контекста (например, `AuthProvider`, `QueryProvider`).
        *   `types/`: Глобальные TypeScript-типы (скопировать интерфейсы `User`, `Hike`, `Pass` и т.д.).

3.  **Базовый UI и Layout:**
    *   Создать основной `app/layout.tsx`.
    *   Реализовать компоненты `Header` и `Footer`. В `Header` предусмотреть место для навигации, логотипа и кнопки "Войти".
    *   Настроить провайдер для `React Query` (`QueryClientProvider`) в `layout.tsx`.

4.  **Аутентификация (Основа):**
    *   Создать `AuthContext` и провайдер для хранения состояния пользователя (`User | null`).
    *   Создать хук `useAuth`, который будет делать запрос к `GET /api/users/me` при загрузке приложения для определения текущего пользователя.

**UX/UI:** Определить основную цветовую палитру, шрифты и общую сетку сайта.

---

### **Этап 2: Core Public Features (Спринты 2-4, ~3 недели)**

**Цель:** Реализовать основной публичный функционал, который увидят посетители сайта. Сделать сайт живым и наполненным контентом.

**Приоритет:** 1. Новости/Статьи -> 2. Походы -> 3. Авторизация/Регистрация.

**Технические задачи:**

1.  **Раздел Новостей и Статей:**
    *   Создать страницы-списки: `app/news/page.tsx` и `app/articles/page.tsx`.
        *   Использовать `useQuery` из React Query для получения данных с `GET /api/news` и `GET /api/articles`.
        *   Создать компонент `ArticleCard` (или `ContentCard`) для отображения превью.
    *   Создать динамические страницы для детального просмотра: `app/news/[slug]/page.tsx` и `app/articles/[slug]/page.tsx`.
        *   Использовать `generateMetadata` для SEO (title, description).
        *   Получать данные по `slug` и рендерить `content_html` от Tiptap.
        *   **Важно:** Создать компонент для безопасного рендеринга HTML, чтобы избежать XSS.

2.  **Архив Походов:**
    *   Создать страницу `app/archive/hikes/page.tsx` со списком походов.
        *   Реализовать базовую фильтрацию (по сложности, региону) и поиск.
    *   Создать детальную страницу похода `app/archive/hikes/[id]/page.tsx`.
        *   **Интерактивная карта:**
            *   Создать компонент `MapboxMap` (`components/MapboxMap.tsx`).
            *   Использовать `react-map-gl` для удобной интеграции с React.
            *   Передавать `geojson_data` из API в компонент карты для отрисовки маршрута.
            *   Настроить стили карты, маркеры старта/финиша.
        *   Отобразить всю информацию о походе, включая ссылки на скачивание отчета (`GET /api/archive/hikes/{id}/file/report`).

3.  **Каталог Перевалов:**
    *   Аналогично походам, создать `app/archive/passes/page.tsx` и `app/archive/passes/[id]/page.tsx`.
    *   На странице перевала выводить список походов, проходящих через него (`GET /api/archive/passes/{id}/hikes`).

4.  **Регистрация и Авторизация:**
    *   Создать страницы `app/login/page.tsx` и `app/register/page.tsx`.
    *   Использовать `React Hook Form` и `Zod` для валидации форм.
    *   Использовать `useMutation` из React Query для отправки запросов на `POST /api/auth/login` и `POST /api/auth/register`.
    *   При успешном логине обновлять `AuthContext` и перенаправлять пользователя. Backend установит http-only cookie.

**UX/UI:** Карточки контента должны быть адаптивными. Карта на странице похода должна быть центральным элементом. Формы должны давать четкую обратную связь об ошибках.

**План тестирования:** Проверить рендеринг списков и детальных страниц. Убедиться, что карта корректно отображает маршрут. Протестировать флоу регистрации и входа.

---

### **Этап 3: User & Admin Panel (Спринты 5-7, ~3 недели)**

**Цель:** Создать защищенные разделы для пользователей и администраторов. Дать администраторам инструменты для управления контентом.

**Зависимости:** Рабочая аутентификация.

**Технические задачи:**

1.  **Создание защищенных роутов:**
    *   Создать `app/(protected)/layout.tsx` или использовать middleware для защиты роутов `/profile` и `/admin`. Проверять наличие и роль пользователя из `useAuth`.

2.  **Личный кабинет пользователя (`/profile`):**
    *   Страница с информацией о пользователе (`GET /api/users/me`).
    *   Раздел "Мои походы" (потребуется соответствующий эндпоинт от backend, например `GET /api/users/me/hikes`).

3.  **Административная панель (Layout):**
    *   Создать `app/admin/layout.tsx` с боковой навигацией по разделам (Пользователи, Походы, Статьи и т.д.).

4.  **Управление Статьями и Новостями (CRUD):**
    *   Создать страницы `app/admin/articles/page.tsx` и `app/admin/news/page.tsx` с таблицами (`shadcn/ui/table`) для отображения контента.
    *   Создать страницы для создания/редактирования: `app/admin/articles/new/page.tsx`, `app/admin/articles/edit/[id]/page.tsx`.
    *   **Интеграция Tiptap:**
        *   Создать компонент `RichTextEditor` (`components/RichTextEditor.tsx`), инкапсулирующий Tiptap.
        *   Подключить его к `React Hook Form` через `<Controller>`.
        *   При сохранении получать JSON (`editor.getJSON()`) и отправлять на `POST /api/articles` или `PATCH /api/articles/{id}`.

5.  **Управление Походами (CRUD):**
    *   Создать форму для создания/редактирования похода.
    *   Реализовать загрузку файлов (GPX, PDF) через `multipart/form-data`.
    *   Использовать `useMutation` для отправки данных.

6.  **Управление Пользователями и Участниками:**
    *   Создать простые интерфейсы с таблицами для просмотра пользователей (`GET /api/users`) и участников (`GET /api/club/participants`).
    *   Реализовать функции удаления и, возможно, редактирования ролей.

**UX/UI:** Админ-панель должна быть функциональной и быстрой. Использовать компоненты `shadcn/ui` (Table, Dialog, Forms, Toasts) для построения консистентного интерфейса.

**План тестирования:** Протестировать все CRUD-операции. Убедиться, что загрузка файлов работает. Проверить, что Tiptap корректно сохраняет и отображает контент. Проверить защиту роутов.

---

### **Этап 4: Advanced Features & Polish (Спринты 8-9, ~2 недели)**

**Цель:** Добавить дополнительный функционал, провести оптимизацию, отполировать UX/UI и подготовить проект к запуску.

**Технические задачи:**

1.  **Связывание сущностей:**
    *   В админ-панели на странице редактирования похода добавить интерфейс для привязки перевалов (`POST /api/archive/link`). Это может быть модальное окно с поиском и выбором перевала.

2.  **Страница "О клубе":**
    *   Создать `app/about/page.tsx`.
    *   Вывести информацию о клубе и список участников с аватарами (`GET /api/club/participants`).

3.  **Оптимизация производительности:**
    *   Использовать `next/dynamic` для ленивой загрузки тяжелых компонентов (Mapbox, Tiptap).
    *   Оптимизировать изображения с помощью `next/image`.
    *   Проанализировать бандл с помощью `@next/bundle-analyzer`.

4.  **UX/UI Polish:**
    *   Добавить "скелетоны" (loading skeletons) от `shadcn/ui` на время загрузки данных.
    *   Использовать `sonner` или `react-hot-toast` для уведомлений (например, "Статья успешно создана").
    *   Тщательно протестировать и доработать адаптивный дизайн для мобильных устройств.

5.  **SEO и Open Graph:**
    *   Проверить и донастроить `generateMetadata` на всех публичных страницах для корректного отображения в соцсетях (OG tags).

**План тестирования:** Провести end-to-end тестирование основных пользовательских сценариев (регистрация -> просмотр похода; админ-логин -> создание статьи). Проверить сайт на разных устройствах и браузерах.
