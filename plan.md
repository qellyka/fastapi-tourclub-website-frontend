# План работ по улучшению функционала

На основе ваших заметок был составлен следующий план работ:

## 1. Пробелы в регистрации
*   **Проблема:** Ошибка с сервера при наличии пробелов в поле "Имя" (и, предположительно, в других текстовых полях).
*   **Решение:** Добавлено поле "Отчество (необязательно)" в схему валидации и в JSX формы регистрации (`src/components/AuthModal.tsx`).
*   **Дополнительное решение:** Реализовать обрезку пробелов (trimming) для текстовых полей перед отправкой данных на сервер.
*   **Дальнейшие шаги (потенциальные улучшения):**
    *   Добавление поля "Подтверждение пароля" для улучшения пользовательского опыта и безопасности.
    *   Интеграция чекбокса для согласия с условиями использования/политикой конфиденциальности.
    *   Улучшение отображения общих ошибок сервера (например, "имя пользователя уже занято") непосредственно в форме.

## 2. Редактирование профиля в админке
*   **Проблема:** Ошибка, если не указана фамилия при редактировании профиля в админке.
*   **Текущий статус:** Проверена страница редактирования пользователя (`src/app/admin/users/[id]/edit/page.tsx`). Функционал редактирования основных полей пользователя, включая отчество и роли, уже реализован.
*   **Дополнительное решение:** Проверить схему валидации на стороне клиента и сервера для поля "Фамилия". Если поле является обязательным, но допускает пустое значение, это может быть причиной ошибки. Необходимо убедиться, что поле "Фамилия" либо необязательно, либо имеет корректную валидацию.
*   **Дальнейшие шаги:** Считается выполненным, если нет конкретных багов или отсутствующих полей, которые не были упомянуты.

## 3. Отображение ФИО в мобильной версии
*   **Проблема:** ФИО в мобильной версии может быть слишком длинным и перекрывать иконки.
*   **Решение:** Будет проведена проверка CSS и адаптивного дизайна в компонентах, где отображается ФИО (например, профили пользователей, участники походов, списки пользователей в админке). Будут внесены корректировки в стили (размер шрифта, переносы строк, свойства `overflow: hidden; text-overflow: ellipsis; white-space: nowrap;`) для корректного отображения на маленьких экранах. Возможно, потребуется сокращение ФИО до инициалов или отображение только имени и фамилии с возможностью полного просмотра по клику.
*   **Компоненты для проверки:**
    *   `src/app/(protected)/profile/page.tsx`
    *   `src/app/(protected)/profile/[username]/page.tsx`
    *   `src/components/HikeParticipants.tsx`
    *   `src/app/admin/users/page.tsx`
    *   `src/app/admin/school-applications/[id]/ApplicationDetailClientPage.tsx`

## 4. Админку в мобильной версии
*   **Проблема:** Ужасная работа админки на мобильных устройствах: невозможно создать запись, постоянные ошибки, панель управления не убирается.
*   **Решение:** Будет проведен комплексный аудит всех компонентов админ-панели. Будут выявлены области с плохой адаптивностью (таблицы, формы, навигация) и реализованы принципы адаптивного дизайна (медиа-запросы CSS, гибкие макеты). Приоритет будет отдан ключевым функциям админки, особенно исправлению ошибок при создании записей и улучшению навигации/скрытию панелей.

## 5. Добавить редактирование вопросов (FAQ)
*   **Проблема:** Необходимость добавления функционала для редактирования FAQ вопросов (добавление, удаление, изменение).
*   **Решение (Backend API Design):**
    *   **Таблица БД (пример):** `faqs`
        *   `id` (INT, PRIMARY KEY, AUTO_INCREMENT)
        *   `question_ru` (TEXT, NOT NULL) - Вопрос на русском
        *   `answer_ru` (TEXT, NOT NULL) - Ответ на русском
        *   `question_en` (TEXT, NULL) - Вопрос на английском (опционально)
        *   `answer_en` (TEXT, NULL) - Ответ на английском (опционально)
        *   `order` (INT, NOT NULL, DEFAULT 0) - Порядок отображения
        *   `is_active` (BOOLEAN, NOT NULL, DEFAULT TRUE) - Активен ли вопрос
        *   `created_at` (DATETIME, DEFAULT CURRENT_TIMESTAMP)
        *   `updated_at` (DATETIME, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP)
    *   **API Ручки:**
        *   **GET /api/admin/faqs:** Получить все FAQ (для админки).
            *   Параметры запроса: `is_active` (boolean, optional), `lang` (string, optional, e.g., 'ru', 'en')
            *   Ответ: `ApiResponse<FAQItem[]>`
        *   **GET /api/faqs:** Получить активные FAQ (для публичной части).
            *   Параметры запроса: `lang` (string, optional, e.g., 'ru', 'en')
            *   Ответ: `ApiResponse<FAQItem[]>`
        *   **GET /api/admin/faqs/{id}:** Получить конкретный FAQ по ID.
            *   Ответ: `ApiResponse<FAQItem>`
        *   **POST /api/admin/faqs:** Создать новый FAQ.
            *   Тело запроса: `{ question_ru: string, answer_ru: string, question_en?: string, answer_en?: string, order?: int, is_active?: boolean }`
            *   Ответ: `ApiResponse<FAQItem>`
        *   **PUT /api/admin/faqs/{id}:** Полностью обновить FAQ по ID.
            *   Тело запроса: `{ question_ru: string, answer_ru: string, question_en?: string, answer_en?: string, order?: int, is_active?: boolean }`
            *   Ответ: `ApiResponse<FAQItem>`
        *   **PATCH /api/admin/faqs/{id}:** Частично обновить FAQ по ID.
            *   Тело запроса: `{ question_ru?: string, answer_ru?: string, question_en?: string, answer_en?: string, order?: int, is_active?: boolean }`
            *   Ответ: `ApiResponse<FAQItem>`
        *   **DELETE /api/admin/faqs/{id}:** Удалить FAQ по ID.
            *   Ответ: `ApiResponse<message: string>`
*   **Решение (Frontend):** Будет создан новый раздел в админке для управления FAQ, включающий таблицу для просмотра, формы для добавления/редактирования и кнопки для удаления.

## 6. Добавить статистику в админку
*   **Проблема:** Отсутствие раздела статистики в админ-панели.
*   **Решение (Backend API Design):**
    *   **API Ручка:**
        *   **GET /api/admin/statistics:** Получить общую статистику.
            *   Ответ: `ApiResponse<StatisticsData>`
    *   **Ожидаемые метрики и формат данных (пример `StatisticsData`):**
        ```json
        {
          "total_users": 1234,
          "active_users_last_30_days": 567,
          "new_users_last_30_days": 89,
          "total_hikes": 120,
          "hikes_by_status": {
            "PUBLISHED": 80,
            "DRAFT": 20,
            "REVIEW": 15,
            "ARCHIVED": 5
          },
          "total_school_applications": 300,
          "school_applications_by_status": {
            "PENDING": 100,
            "APPROVED": 150,
            "REJECTED": 50
          },
          "total_articles": 50,
          "total_news": 70,
          "total_passes": 40
        }
        ```
*   **Решение (Frontend):** Будет создан новый раздел в админке для отображения этих метрик в удобном для восприятия виде (например, с использованием карточек, графиков).

## 7. Отображение контента новостей и статьи
*   **Проблема:** Некорректное отображение содержимого новостей и статей.
*   **Решение:** Будут проверены компоненты, отвечающие за рендеринг контента (например, `src/app/news/[slug]/page.tsx`, `src/app/(protected)/articles/[slug]/page.tsx`, `RichTextRenderer.tsx`). Будет проверена корректность обработки HTML/JSON из редактора и применены необходимые стили.

## 8. Нерабочая админка на мобилке
*   **Проблема:** Неработоспособность или серьезные проблемы с функционалом админ-панели на мобильных устройствах.
*   **Решение:** Эта задача будет решаться в рамках пункта 4 ("Админку в мобильной версии"), с особым акцентом на устранение критических ошибок, препятствующих использованию админки на мобильных устройствах.