# üèïÔ∏è Hikes API ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä—É—á–µ–∫

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ `/api/archive/hikes`  
–ê–∫—Ç—É–∞–ª—å–Ω–æ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º –∏ –ø–æ–ª—è `difficulty_distribution` (—Ç–µ–ø–µ—Ä—å —ç—Ç–æ `dict[str, int]`).

---

## üìò 1. GET /api/archive/hikes
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ—Ö–æ–¥–æ–≤.

### üîπ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
–ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

### üîπ –¢—Ä–µ–±—É–µ–º–∞—è —Ä–æ–ª—å:
`guest`

### üîπ –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "status": "success",
  "message": "ok",
  "detail": [
    {
      "id": 1,
      "slug": "altai-2024",
      "name": "–ü–æ—Ö–æ–¥ –ø–æ –ê–ª—Ç–∞—é",
      "start_date": "2024-08-05",
      "end_date": "2024-08-12",
      "tourism_type": "–ø–µ—à–∏–π",
      "complexity": "1 –∫.—Å.",
      "region": "–ê–ª—Ç–∞–π",
      "leader_fullname": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
      "status": "published"
    }
  ]
}
```

### üîπ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
`CreateResponse[List[HikesRead]]`

---

## üìó 2. GET /api/archive/hikes/{identification}
–ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Ö–æ–¥–µ –ø–æ `id` –∏–ª–∏ `slug`.

### üîπ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `identification`: `int | str` ‚Äî ID –∏–ª–∏ slug –ø–æ—Ö–æ–¥–∞.

### üîπ –¢—Ä–µ–±—É–µ–º–∞—è —Ä–æ–ª—å:
`guest`

### üîπ –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "status": "success",
  "message": "ok",
  "detail": {
    "id": 7,
    "name": "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –ê–ª—Ç–∞—é",
    "slug": "altai-2024",
    "tourism_type": "–ø–µ—à–∏–π",
    "complexity": "1 –∫.—Å.",
    "region": "–ê–ª—Ç–∞–π",
    "route": "–ì–æ—Ä–Ω–æ-–ê–ª—Ç–∞–π—Å–∫ ‚Äî –¢–µ–ª–µ—Ü–∫–æ–µ –æ–∑–µ—Ä–æ",
    "start_date": "2024-08-05",
    "end_date": "2024-08-12",
    "description": "–ú–∞—Ä—à—Ä—É—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–≤–∞–ª—ã –Æ–∂–Ω–æ–≥–æ –ê–ª—Ç–∞—è.",
    "participants_count": 6,
    "duration_days": 8,
    "distance_km": 80.5,
    "difficulty_distribution": {
      "1–ê": 2,
      "1–ë": 3,
      "2–ê": 1
    },
    "leader_id": 3,
    "photos_archive": "https://example.com/photos.zip",
    "report_s3_key": "a0b23c.pdf",
    "route_s3_key": "g1d45f.gpx",
    "geojson_data": {},
    "status": "published",
    "created_by": 1,
    "updated_by": 1
  }
}
```

### üîπ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
`CreateResponse[HikeRead]`

---

## üìï 3. POST /api/archive/hikes
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Ö–æ–¥ (—Å –æ—Ç—á—ë—Ç–æ–º –∏ GPX —Ñ–∞–π–ª–æ–º).

### üîπ –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:
`multipart/form-data`

### üîπ –¢—Ä–µ–±—É–µ–º–∞—è —Ä–æ–ª—å:
`admin`

### üîπ –ü–æ–ª—è —Ñ–æ—Ä–º—ã:
| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|-------------|-----------|
| `report_file` | `UploadFile (pdf)` | ‚úÖ | –§–∞–π–ª –æ—Ç—á—ë—Ç–∞ |
| `gpx_file` | `UploadFile (gpx)` | ‚úÖ | GPX —Ç—Ä–µ–∫ –º–∞—Ä—à—Ä—É—Ç–∞ |
| `name` | `string` | ‚úÖ | –ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ—Ö–æ–¥–∞ |
| `tourism_type` | `string` | ‚úÖ | –¢–∏–ø —Ç—É—Ä–∏–∑–º–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ø–µ—à–∏–π") |
| `complexity` | `string` | ‚úÖ | –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∞ |
| `region` | `string` | ‚ùå | –†–µ–≥–∏–æ–Ω –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è |
| `route` | `string` | ‚úÖ | –ù–∏—Ç–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞ |
| `start_date` | `date` | ‚úÖ | –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–æ—Ö–æ–¥–∞ |
| `end_date` | `date` | ‚úÖ | –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è |
| `description` | `string` | ‚ùå | –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Ö–æ–¥–∞ |
| `participants_count` | `int` | ‚úÖ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |
| `duration_days` | `int` | ‚ùå | –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –¥–Ω—è—Ö |
| `distance_km` | `float` | ‚ùå | –ü—Ä–æ—Ç—è–∂–µ–Ω–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–∞ |
| `difficulty_distribution` | `object` | ‚ùå | –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä: `{ "1–ë": 5, "1–ê": 1 }` |
| `leader_id` | `int` | ‚úÖ | ID —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –ø–æ—Ö–æ–¥–∞ |
| `photos_archive` | `string` | ‚ùå | –°—Å—ã–ª–∫–∞ –Ω–∞ –∞—Ä—Ö–∏–≤ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ |

---

### üîπ –ü—Ä–∏–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞:
(—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `multipart/form-data`)
```
report_file: report.pdf
gpx_file: route.gpx
name: –ü–æ—Ö–æ–¥ –ø–æ –ê–ª—Ç–∞—é
tourism_type: –ø–µ—à–∏–π
complexity: 1 –∫.—Å.
region: –ê–ª—Ç–∞–π
route: –ì–æ—Ä–Ω–æ-–ê–ª—Ç–∞–π—Å–∫ ‚Äî –¢–µ–ª–µ—Ü–∫–æ–µ –æ–∑–µ—Ä–æ
start_date: 2024-08-05
end_date: 2024-08-12
participants_count: 6
leader_id: 3
difficulty_distribution: {"1–ê": 2, "1–ë": 3, "2–ê": 1}
```

### üîπ –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "status": "success",
  "message": "New report of hike was created",
  "detail": {
    "id": 12,
    "name": "–ü–æ—Ö–æ–¥ –ø–æ –ê–ª—Ç–∞—é",
    "slug": "pohod-po-altayu",
    "tourism_type": "–ø–µ—à–∏–π",
    "complexity": "1 –∫.—Å.",
    "leader_id": 3,
    "participants_count": 6,
    "difficulty_distribution": {
      "1–ê": 2,
      "1–ë": 3
    },
    "report_s3_key": "a0b23c.pdf",
    "route_s3_key": "g1d45f.gpx",
    "geojson_data": {},
    "created_by": 1,
    "updated_by": 1
  }
}
```

### üîπ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
`CreateResponse[HikeRead]`

---

## üìô 4. PATCH /api/archive/hikes/{hike_id}
–û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Ö–æ–¥–µ.

### üîπ –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:
`multipart/form-data`

### üîπ –¢—Ä–µ–±—É–µ–º–∞—è —Ä–æ–ª—å:
`admin`

### üîπ –ü–æ–ª—è —Ñ–æ—Ä–º—ã:
–¢–µ –∂–µ, —á—Ç–æ –∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏, –Ω–æ –≤—Å–µ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ.

### üîπ –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `report_file` ‚Äî –Ω–æ–≤—ã–π PDF –æ—Ç—á—ë—Ç (–ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Å—Ç–∞—Ä—ã–π)
- `gpx_file` ‚Äî –Ω–æ–≤—ã–π GPX –º–∞—Ä—à—Ä—É—Ç (–æ–±–Ω–æ–≤–∏—Ç geojson)

---

### üîπ –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```
PATCH /api/archive/hikes/7

FormData:
{
  "description": "–î–æ–±–∞–≤–ª–µ–Ω–æ —É—Ç–æ—á–Ω–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞",
  "participants_count": 7,
  "difficulty_distribution": {"1–ë": 3, "2–ê": 2}
}
```

### üîπ –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "status": "succes",
  "message": "ok",
  "detail": {
    "id": 7,
    "name": "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –ê–ª—Ç–∞—é",
    "slug": "altai-2024",
    "participants_count": 7,
    "difficulty_distribution": {
      "1–ë": 3,
      "2–ê": 2
    },
    "updated_by": 1
  }
}
```

### üîπ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
`CreateResponse[HikeRead]`

---

## üìí 5. DELETE /api/archive/hikes/{hike_id}
–£–¥–∞–ª–∏—Ç—å –ø–æ—Ö–æ–¥ –ø–æ ID.

### üîπ –¢—Ä–µ–±—É–µ–º–∞—è —Ä–æ–ª—å:
`admin`

### üîπ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `hike_id`: `int` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—Ö–æ–¥–∞

### üîπ –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
–ö–æ–¥ `204 No Content` (–±–µ–∑ —Ç–µ–ª–∞).

---

## üìî 6. GET /api/archive/hikes/{hike_id}/file/{file_type}
–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –æ—Ç—á—ë—Ç–∞ –∏–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞.

### üîπ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `hike_id`: `int`
- `file_type`: `"report"` –∏–ª–∏ `"route"`

### üîπ –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```
GET /api/archive/hikes/7/file/report
```

### üîπ –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª (`application/pdf` –∏–ª–∏ `application/gpx+xml`).

---

## üßæ –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –ü–æ–ª–µ `difficulty_distribution` —Ç–µ–ø–µ—Ä—å JSON-—Å–ª–æ–≤–∞—Ä—å (`dict[str, int]`).
- ORM –º–æ–¥–µ–ª—å —Ö—Ä–∞–Ω–∏—Ç –µ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `JSON`, Pydantic ‚Äî –∫–∞–∫ `dict`.
- –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ (CRUD, —Ä—É—á–∫–∏, –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤) –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π.
